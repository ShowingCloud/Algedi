# Data Model Strategy

We use a Split-Schema approach within a single PostgreSQL database to allow tight integration but logical separation.

## 1. Commerce Schema (The Abstract Core)

Owned by `apps/commerce-core`. Syncs with Medusa.

### Tenant

The agency/company.

- `id`: UUID
- `stripe_connect_id`: For revenue sharing.
- `subscription_tier`: free, pro, enterprise.

### Product

Abstract product data.

- `id`: UUID
- `tenant_id`: UUID (RLS Key)
- `attributes`: JSONB (Stores flexible data: `{ "ram": "16gb", "fabric": "wool" }`)
- `inventory_count`: Int

### Customer

A global profile.

- `id`: UUID
- `email`: String
- `global_consent`: Boolean (Has user opted into cross-tenant sharing?)

### TenantCustomer

The link between a user and a specific shop.

- `tenant_id`: UUID
- `customer_id`: UUID
- `marketing_opt_in`: Boolean (Specific to this agency).

## 2. CMS Schema (The Presentation Layer)

Owned by `apps/cms`. Controls how data looks.

### SiteConfig

- `tenant_id`: UUID
- `domain`: String (`"https://www.google.com/search?q=shop.agency.com"`)
- `theme_tokens`: JSONB (`{ "primary": "#ff0000", "radius": "4px" }`)

### PageTemplate

- `id`: UUID
- `structure_json`: JSONB (The tree structure generated by the Editor).
- `is_published`: Boolean

## 3. Editor Schema (The AI Memory)

Owned by `packages/ai-editor`. Stores the "work in progress".

### AssetDescription

- `image_hash`: String (Unique ID of the image file).
- `ai_description`: Text (Generated by Vision LLM).
- `embedding`: Vector (For semantic search).

### PromptLog

- `tenant_id`: UUID
- `prompt_text`: Text
- `generated_code`: Text
- `tokens_used`: Int (CRITICAL for billing).
