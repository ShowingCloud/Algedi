Data Model Specification
We utilize a Shared Database, Shared Schema architecture with PostgreSQL Row-Level Security (RLS).

1. Core Tenants (Global)
Organization: The Agency/Company.

id (UUID): Primary Key.

stripe_connect_id: For Revenue Share payouts.

custom_domain: e.g., "https://www.google.com/url?sa=E&source=gmail&q=shop.agency.com".

settings: JSONB (Theme tokens, logo, footer config).

2. Billing & Credits (The Ledger)
CreditLedger: Immutable log of AI usage.

id: UUID.

organization_id: FK.

amount: Int (Positive for purchase, Negative for usage).

type: Enum ('PURCHASE', 'GENERATION', 'REFUND').

balance_snapshot: Int (The balance after this transaction).

resource_id: String (Link to the Image/Page generated).

expires_at: DateTime (For promotional credits).

3. Editor Content (The "Work in Progress")
PageTemplate:

id: UUID.

organization_id: FK.

path: String (e.g., "/about").

schema: JSONB (The internal representation of the page tree).

is_published: Boolean.

Asset:

id: UUID.

url: String (S3/R2 URL).

ai_description: Text (Generated by Vision Model).

embedding: Vector (pgvector column for semantic search).

4. Commerce (Abstract)
Product (Synced/Referenced from Medusa):

id: UUID.

organization_id: FK.

external_id: String (Medusa Product ID).

extended_attributes: JSONB (AI-generated tags, SEO descriptions).